<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Vision Screening Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            color: #fff;
        }

        .progress-bar {
            flex: 1;
            max-width: 400px;
            margin: 0 2rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 8px;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #fff;
        }

        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            color: #333;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .test-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #1e3c72;
            font-weight: 300;
        }

        .test-subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #666;
        }

        .instructions {
            text-align: left;
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .instructions h3 {
            color: #1e3c72;
            margin-bottom: 1rem;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .instructions li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(45deg, #2196F3, #1e3c72);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem;
            min-width: 150px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .calibration-card {
            border: 2px solid #333;
            width: 85.6mm;
            height: 53.98mm;
            background: #fff;
            border-radius: 5px;
            margin: 2rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: #333;
            position: relative;
        }

        .letter-e {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #000;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .direction-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            max-width: 300px;
            margin: 2rem auto;
        }

        .direction-btn {
            padding: 1rem;
            border: 2px solid #2196F3;
            background: white;
            color: #2196F3;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .direction-btn:hover {
            background: #2196F3;
            color: white;
        }

        .contrast-pattern {
            width: 200px;
            height: 200px;
            margin: 2rem auto;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }

        .color-test-circle {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            margin: 2rem auto;
            position: relative;
            overflow: hidden;
        }

        .astigmatism-chart {
            width: 300px;
            height: 300px;
            margin: 2rem auto;
            position: relative;
            border-radius: 50%;
            background: radial-gradient(circle, transparent 50px, #000 51px, #000 52px, transparent 53px);
        }

        .astigmatism-line {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150px;
            height: 2px;
            background: #000;
            transform-origin: 0 50%;
            transform: translate(-50%, -50%);
        }

        .visual-field-test {
            width: 400px;
            height: 400px;
            margin: 2rem auto;
            position: relative;
            border-radius: 50%;
            background: #f0f0f0;
            border: 2px solid #ccc;
        }

        .fixation-point {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .test-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #000;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .test-dot:hover {
            background: #ff0000;
        }

        .input-field {
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            margin: 1rem;
            max-width: 200px;
        }

        .result-section {
            text-align: left;
            margin: 2rem 0;
        }

        .result-item {
            background: #f8f9fa;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .result-good {
            border-left-color: #4CAF50;
        }

        .result-attention {
            border-left-color: #ff9800;
        }

        .result-concern {
            border-left-color: #f44336;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .countdown {
            font-size: 3rem;
            color: #ff0000;
            font-weight: bold;
            margin: 2rem 0;
        }

        .test-number {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">OnlineEyeTest.xyz</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Ready to start</div>
        </div>

        <div class="main-content">
            <!-- Welcome Screen -->
            <div class="test-section" id="welcomeScreen">
                <h1 class="test-title">Online Vision Screening Test</h1>
                <p class="test-subtitle">Comprehensive eye health assessment in 5-10 minutes</p>
                
                <div class="instructions">
                    <h3>Before you begin:</h3>
                    <ul>
                        <li>Position your device at arm's length (about 60cm away)</li>
                        <li>Ensure good lighting - avoid glare on your screen</li>
                        <li>Remove glasses or contact lenses unless specified</li>
                        <li>Sit comfortably with both eyes open</li>
                        <li>This test cannot replace professional eye examination</li>
                    </ul>
                </div>
                
                <button class="btn" onclick="startTest()">Start Vision Test</button>
            </div>

            <!-- Screen Calibration -->
            <div class="test-section hidden" id="calibrationScreen">
                <h2 class="test-title">Screen Calibration</h2>
                <p class="test-subtitle">Adjust your viewing distance for accurate results</p>
                
                <div class="instructions">
                    <h3>Calibration Instructions:</h3>
                    <ul>
                        <li>Hold a credit card against your screen</li>
                        <li>The card should match the size of the rectangle below</li>
                        <li>Adjust your distance until they match perfectly</li>
                        <li>This ensures proper test scaling</li>
                    </ul>
                </div>
                
                <div class="calibration-card">
                    <div>Credit Card Size<br>85.6mm × 53.98mm</div>
                </div>
                
                <button class="btn" onclick="nextStep()">Calibration Complete</button>
            </div>

            <!-- Visual Acuity Test -->
            <div class="test-section hidden" id="acuityTest">
                <div class="test-number">Test 1 of 5: Visual Acuity</div>
                <h2 class="test-title">Visual Acuity Test</h2>
                <p class="test-subtitle">Identify the direction of the letter E opening</p>
                
                <div id="letterDisplay">
                    <div class="letter-e" id="testLetter" style="font-size: 120px;">E</div>
                </div>
                
                <div class="direction-buttons">
                    <button class="direction-btn" onclick="selectDirection('up')">↑ Up</button>
                    <button class="direction-btn" onclick="selectDirection('down')">↓ Down</button>
                    <button class="direction-btn" onclick="selectDirection('left')">← Left</button>
                    <button class="direction-btn" onclick="selectDirection('right')">→ Right</button>
                </div>
                
                <div id="acuityLevel">Level: 1/8</div>
            </div>

            <!-- Contrast Sensitivity Test -->
            <div class="test-section hidden" id="contrastTest">
                <div class="test-number">Test 2 of 5: Contrast Sensitivity</div>
                <h2 class="test-title">Contrast Sensitivity Test</h2>
                <p class="test-subtitle">Identify the direction of the stripes</p>
                
                <div class="contrast-pattern" id="contrastPattern"></div>
                
                <div class="direction-buttons">
                    <button class="direction-btn" onclick="selectContrastDirection('left')">↙ Left Tilt</button>
                    <button class="direction-btn" onclick="selectContrastDirection('right')">↘ Right Tilt</button>
                </div>
                
                <div id="contrastLevel">Level: 1/6</div>
            </div>

            <!-- Color Vision Test -->
            <div class="test-section hidden" id="colorTest">
                <div class="test-number">Test 3 of 5: Color Vision</div>
                <h2 class="test-title">Color Vision Test</h2>
                <p class="test-subtitle">Enter the number you see in the colored dots</p>
                
                <div class="color-test-circle" id="colorCircle"></div>
                
                <input type="number" class="input-field" id="colorInput" placeholder="Enter number" min="0" max="99">
                <br>
                <button class="btn" onclick="submitColorAnswer()">Submit Answer</button>
                <button class="btn btn-secondary" onclick="skipColorTest()">Can't See Number</button>
                
                <div id="colorLevel">Image: 1/4</div>
            </div>

            <!-- Astigmatism Test -->
            <div class="test-section hidden" id="astigmatismTest">
                <div class="test-number">Test 4 of 5: Astigmatism</div>
                <h2 class="test-title">Astigmatism Test</h2>
                <p class="test-subtitle">Select the clearest and most blurred lines</p>
                
                <div class="astigmatism-chart" id="astigmatismChart"></div>
                
                <div style="margin: 2rem 0;">
                    <p>Click on the <strong>clearest</strong> line:</p>
                    <div id="clearestSelection">No line selected</div>
                </div>
                
                <div style="margin: 2rem 0;">
                    <p>Click on the <strong>most blurred</strong> line:</p>
                    <div id="blurredSelection">No line selected</div>
                </div>
                
                <button class="btn" onclick="submitAstigmatismAnswer()" id="astigmatismSubmit" disabled>Submit Answer</button>
            </div>

            <!-- Visual Field Test -->
            <div class="test-section hidden" id="visualFieldTest">
                <div class="test-number">Test 5 of 5: Visual Field</div>
                <h2 class="test-title">Visual Field Test</h2>
                <p class="test-subtitle">Keep your eyes on the red dot, click when you see dots appear</p>
                
                <div class="visual-field-test" id="visualFieldArea">
                    <div class="fixation-point"></div>
                </div>
                
                <div id="fieldTestInfo">
                    <p>Dots detected: <span id="dotsDetected">0</span>/20</p>
                    <div class="countdown" id="fieldCountdown">30</div>
                </div>
                
                <button class="btn" onclick="skipVisualFieldTest()">Skip Test</button>
            </div>

            <!-- Results Screen -->
            <div class="test-section hidden" id="resultsScreen">
                <h2 class="test-title">Vision Screening Results</h2>
                <p class="test-subtitle">Your comprehensive vision assessment</p>
                
                <div class="result-section" id="resultsContent">
                    <!-- Results will be populated here -->
                </div>
                
                <div class="instructions">
                    <h3>Important Notice:</h3>
                    <ul>
                        <li>This screening is not a substitute for professional eye examination</li>
                        <li>Results are indicative only and should not be used for diagnosis</li>
                        <li>Consult an eye care professional for comprehensive evaluation</li>
                        <li>Regular eye exams are recommended for optimal eye health</li>
                    </ul>
                </div>
                
                <button class="btn" onclick="restartTest()">Take Test Again</button>
                <button class="btn btn-secondary" onclick="printResults()">Print Results</button>
            </div>
        </div>
    </div>

    <script>
        let currentTest = 0;
        let testResults = {
            acuity: { correct: 0, total: 0, level: 0 },
            contrast: { correct: 0, total: 0, level: 0 },
            color: { correct: 0, total: 0, answers: [] },
            astigmatism: { clearest: null, blurred: null },
            visualField: { detected: 0, total: 20, missed: 0 }
        };

        let currentAcuityLevel = 1;
        let currentContrastLevel = 1;
        let currentColorImage = 1;
        let visualFieldTimer = null;
        let fieldTestDots = [];
        let fieldTestActive = false;

        // Test data
        const acuityDirections = ['up', 'down', 'left', 'right'];
        const contrastDirections = ['left', 'right'];
        const colorTestNumbers = [8, 3, 29, 57];
        const acuitySizes = [120, 100, 80, 60, 45, 35, 25, 18];
        const contrastLevels = [0.8, 0.6, 0.4, 0.3, 0.2, 0.1];

        let currentAcuityDirection = '';
        let currentContrastDirection = '';
        let selectedClearest = null;
        let selectedBlurred = null;

        function updateProgress() {
            const progress = (currentTest / 6) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            const stages = ['Ready to start', 'Calibrating', 'Visual Acuity', 'Contrast Sensitivity', 'Color Vision', 'Astigmatism', 'Visual Field', 'Complete'];
            document.getElementById('progressText').textContent = stages[currentTest];
        }

        function startTest() {
            currentTest = 1;
            hideAllScreens();
            document.getElementById('calibrationScreen').classList.remove('hidden');
            document.getElementById('calibrationScreen').classList.add('fade-in');
            updateProgress();
        }

        function nextStep() {
            currentTest++;
            hideAllScreens();
            
            switch(currentTest) {
                case 2:
                    startAcuityTest();
                    break;
                case 3:
                    startContrastTest();
                    break;
                case 4:
                    startColorTest();
                    break;
                case 5:
                    startAstigmatismTest();
                    break;
                case 6:
                    startVisualFieldTest();
                    break;
                case 7:
                    showResults();
                    break;
            }
            updateProgress();
        }

        function hideAllScreens() {
            const screens = ['welcomeScreen', 'calibrationScreen', 'acuityTest', 'contrastTest', 'colorTest', 'astigmatismTest', 'visualFieldTest', 'resultsScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
                document.getElementById(screen).classList.remove('fade-in');
            });
        }

        function startAcuityTest() {
            document.getElementById('acuityTest').classList.remove('hidden');
            document.getElementById('acuityTest').classList.add('fade-in');
            generateAcuityLetter();
        }

        function generateAcuityLetter() {
            currentAcuityDirection = acuityDirections[Math.floor(Math.random() * acuityDirections.length)];
            const letter = document.getElementById('testLetter');
            letter.style.fontSize = acuitySizes[currentAcuityLevel - 1] + 'px';
            
            let rotation = 0;
            switch(currentAcuityDirection) {
                case 'up': rotation = -90; break;
                case 'down': rotation = 90; break;
                case 'left': rotation = 180; break;
                case 'right': rotation = 0; break;
            }
            letter.style.transform = `rotate(${rotation}deg)`;
            
            document.getElementById('acuityLevel').textContent = `Level: ${currentAcuityLevel}/8`;
        }

        function selectDirection(direction) {
            testResults.acuity.total++;
            if (direction === currentAcuityDirection) {
                testResults.acuity.correct++;
                testResults.acuity.level = currentAcuityLevel;
            }
            
            currentAcuityLevel++;
            if (currentAcuityLevel > 8) {
                nextStep();
            } else {
                generateAcuityLetter();
            }
        }

        function startContrastTest() {
            document.getElementById('contrastTest').classList.remove('hidden');
            document.getElementById('contrastTest').classList.add('fade-in');
            generateContrastPattern();
        }

        function generateContrastPattern() {
            currentContrastDirection = contrastDirections[Math.floor(Math.random() * contrastDirections.length)];
            const pattern = document.getElementById('contrastPattern');
            const contrast = contrastLevels[currentContrastLevel - 1];
            
            const angle = currentContrastDirection === 'left' ? -45 : 45;
            const grayValue = Math.floor(255 * (1 - contrast));
            
            pattern.style.background = `repeating-linear-gradient(${angle}deg, #000 0px, #000 10px, rgb(${grayValue},${grayValue},${grayValue}) 10px, rgb(${grayValue},${grayValue},${grayValue}) 20px)`;
            
            document.getElementById('contrastLevel').textContent = `Level: ${currentContrastLevel}/6`;
        }

        function selectContrastDirection(direction) {
            testResults.contrast.total++;
            if (direction === currentContrastDirection) {
                testResults.contrast.correct++;
                testResults.contrast.level = currentContrastLevel;
            }
            
            currentContrastLevel++;
            if (currentContrastLevel > 6) {
                nextStep();
            } else {
                generateContrastPattern();
            }
        }

        function startColorTest() {
            document.getElementById('colorTest').classList.remove('hidden');
            document.getElementById('colorTest').classList.add('fade-in');
            generateColorTest();
        }

        function generateColorTest() {
            const circle = document.getElementById('colorCircle');
            const number = colorTestNumbers[currentColorImage - 1];
            
            circle.innerHTML = '';
            for (let i = 0; i < 500; i++) {
                const dot = document.createElement('div');
                dot.style.position = 'absolute';
                dot.style.width = '8px';
                dot.style.height = '8px';
                dot.style.borderRadius = '50%';
                dot.style.left = Math.random() * 284 + 'px';
                dot.style.top = Math.random() * 284 + 'px';
                
                if (Math.random() < 0.3) {
                    dot.style.backgroundColor = number === 8 ? '#8B4513' : '#FF6B6B';
                } else {
                    dot.style.backgroundColor = '#4CAF50';
                }
                
                circle.appendChild(dot);
            }
            
            document.getElementById('colorLevel').textContent = `Image: ${currentColorImage}/4`;
            document.getElementById('colorInput').value = '';
        }

        function submitColorAnswer() {
            const answer = parseInt(document.getElementById('colorInput').value);
            const correct = colorTestNumbers[currentColorImage - 1];
            
            testResults.color.total++;
            testResults.color.answers.push({
                expected: correct,
                answered: answer,
                correct: answer === correct
            });
            
            if (answer === correct) {
                testResults.color.correct++;
            }
            
            currentColorImage++;
            if (currentColorImage > 4) {
                nextStep();
            } else {
                generateColorTest();
            }
        }

        function skipColorTest() {
            testResults.color.total++;
            testResults.color.answers.push({
                expected: colorTestNumbers[currentColorImage - 1],
                answered: null,
                correct: false
            });
            
            currentColorImage++;
            if (currentColorImage > 4) {
                nextStep();
            } else {
                generateColorTest();
            }
        }

        function startAstigmatismTest() {
            document.getElementById('astigmatismTest').classList.remove('hidden');
            document.getElementById('astigmatismTest').classList.add('fade-in');
            generateAstigmatismChart();
        }

        function generateAstigmatismChart() {
            const chart = document.getElementById('astigmatismChart');
            chart.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                const line = document.createElement('div');
                line.className = 'astigmatism-line';
                line.style.transform = `translate(-50%, -50%) rotate(${i * 15}deg)`;
                line.style.cursor = 'pointer';
                line.addEventListener('click', () => selectAstigmatismLine(i));
                chart.appendChild(line);
            }
        }

        function selectAstigmatismLine(lineIndex) {
            if (selectedClearest === null) {
                selectedClearest = lineIndex;
                document.getElementById('clearestSelection').textContent = `Line ${lineIndex + 1} selected`;
            } else if (selectedBlurred === null && lineIndex !== selectedClearest) {
                selectedBlurred = lineIndex;
                document.getElementById('blurredSelection').textContent = `Line ${lineIndex + 1} selected`;
                document.getElementById('astigmatismSubmit').disabled = false;
            }
        }

        function submitAstigmatismAnswer() {
            testResults.astigmatism.clearest = selectedClearest;
            testResults.astigmatism.blurred = selectedBlurred;
            nextStep();
        }

        function startVisualFieldTest() {
            document.getElementById('visualFieldTest').classList.remove('hidden');
            document.getElementById('visualFieldTest').classList.add('fade-in');
            
            fieldTestActive = true;
            fieldTestDots = [];
            
            let countdown = 30;
            const countdownElement = document.getElementById('fieldCountdown');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    endVisualFieldTest();
                }
            }, 1000);
            
            visualFieldTimer = setInterval(() => {
                if (fieldTestActive && fieldTestDots.length < 20) {
                    generateFieldDot();
                }
            }, 1500);
        }

        function generateFieldDot() {
            const fieldArea = document.getElementById('visualFieldArea');
            const dot = document.createElement('div');
            dot.className = 'test-dot';
            
            const angle = Math.random() * 2 * Math.PI;
            const radius = 50 + Math.random() * 150;
            const x = 200 + Math.cos(angle) * radius;
            const y = 200 + Math.sin(angle) * radius;
            
            dot.style.left = x + 'px';
            dot.style.top = y + 'px';
            dot.onclick = () => detectFieldDot(dot);
            
            fieldArea.appendChild(dot);
            fieldTestDots.push(dot);
            
            setTimeout(() => {
                if (dot.parentNode) {
                    dot.parentNode.removeChild(dot);
                    testResults.visualField.missed++;
                }
            }, 1000);
        }

        function detectFieldDot(dot) {
            if (dot.parentNode) {
                dot.parentNode.removeChild(dot);
                testResults.visualField.detected++;
                document.getElementById('dotsDetected').textContent = testResults.visualField.detected;
            }
        }

        function endVisualFieldTest() {
            fieldTestActive = false;
            clearInterval(visualFieldTimer);
            nextStep();
        }

        function skipVisualFieldTest() {
            fieldTestActive = false;
            clearInterval(visualFieldTimer);
            nextStep();
        }

        function showResults() {
            document.getElementById('resultsScreen').classList.remove('hidden');
            document.getElementById('resultsScreen').classList.add('fade-in');
            generateResults();
        }

        function generateResults() {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = '';
            
            const acuityScore = (testResults.acuity.correct / testResults.acuity.total) * 100;
            const acuityClass = acuityScore >= 80 ? 'result-good' : acuityScore >= 60 ? 'result-attention' : 'result-concern';
            
            const contrastScore = (testResults.contrast.correct / testResults.contrast.total) * 100;
            const contrastClass = contrastScore >= 80 ? 'result-good' : contrastScore >= 60 ? 'result-attention' : 'result-concern';
            
            const colorScore = (testResults.color.correct / testResults.color.total) * 100;
            const colorClass = colorScore >= 75 ? 'result-good' : colorScore >= 50 ? 'result-attention' : 'result-concern';
            
            const fieldScore = (testResults.visualField.detected / testResults.visualField.total) * 100;
            const fieldClass = fieldScore >= 70 ? 'result-good' : fieldScore >=
